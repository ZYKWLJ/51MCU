#include "lcd1602.h"

/*******************************************************************************
* �� �� ��       : lcd1602_write_cmd
* ��������		 : LCD1602д����
* ��    ��       : cmd��ָ��
* ��    ��    	 : ��
*******************************************************************************/
#if (LCD1602_4OR8_DATA_INTERFACE==0)//8λLCD
void lcd1602_write_cmd(u8 cmd)
{
	LCD1602_RS=0;//ѡ������
	LCD1602_RW=0;//ѡ��д
	LCD1602_E=0;
	LCD1602_DATAPORT=cmd;//׼������
	delay_ms(1);
	LCD1602_E=1;//ʹ�ܽ�E��������д��
	delay_ms(1);
	LCD1602_E=0;//ʹ�ܽ�E���������д��	
}
#else	//4λLCD
void lcd1602_write_cmd(u8 cmd)
{
	LCD1602_RS=0;//ѡ������
	LCD1602_RW=0;//ѡ��д
	LCD1602_E=0;
	LCD1602_DATAPORT=cmd;//׼������
	delay_ms(1);
	LCD1602_E=1;//ʹ�ܽ�E��������д��
	delay_ms(1);
	LCD1602_E=0;//ʹ�ܽ�E���������д��
	
	LCD1602_DATAPORT=cmd<<4;//׼������
	delay_ms(1);
	LCD1602_E=1;//ʹ�ܽ�E��������д��
	delay_ms(1);
	LCD1602_E=0;//ʹ�ܽ�E���������д��	
}
#endif

/*******************************************************************************
* �� �� ��       : lcd1602_write_data
* ��������		 : LCD1602д����
* ��    ��       : dat������
* ��    ��    	 : ��
*******************************************************************************/
#if (LCD1602_4OR8_DATA_INTERFACE==0)//8λLCD
void lcd1602_write_data(u8 dat) 
{
	LCD1602_RS=1;//ѡ������
	LCD1602_RW=0;//ѡ��д
	LCD1602_E=0;
	LCD1602_DATAPORT=dat;//׼������
	delay_ms(1);
	LCD1602_E=1;//ʹ�ܽ�E��������д��
	delay_ms(1);
	LCD1602_E=0;//ʹ�ܽ�E���������д��		
}
#else
void lcd1602_write_data(u8 dat) 
{
	LCD1602_RS=1;//ѡ������
	LCD1602_RW=0;//ѡ��д
	LCD1602_E=0;
	LCD1602_DATAPORT=dat;//׼������
	delay_ms(1);
	LCD1602_E=1;//ʹ�ܽ�E��������д��
	delay_ms(1);
	LCD1602_E=0;//ʹ�ܽ�E���������д��
	
	LCD1602_DATAPORT=dat<<4;//׼������
	delay_ms(1);
	LCD1602_E=1;//ʹ�ܽ�E��������д��
	delay_ms(1);
	LCD1602_E=0;//ʹ�ܽ�E���������д��		
}
#endif

/*******************************************************************************
* �� �� ��       : lcd1602_init
* ��������		 : LCD1602��ʼ��
* ��    ��       : ��
* ��    ��    	 : ��
*******************************************************************************/
#if (LCD1602_4OR8_DATA_INTERFACE==0)//8λLCD
void lcd1602_init(void)
{
	lcd1602_write_cmd(0x38);//��������8λ����ʾ2�У�5*7����/�ַ�
	lcd1602_write_cmd(0x0c);//��ʾ���ܿ����޹�꣬�����˸
	lcd1602_write_cmd(0x06);//д�������ݺ������ƣ���ʾ�����ƶ�
	lcd1602_write_cmd(0x01);//����	
}
#else
void lcd1602_init(void)
{
	lcd1602_write_cmd(0x28);//��������4λ����ʾ2�У�5*7����/�ַ�
	lcd1602_write_cmd(0x0c);//��ʾ���ܿ����޹�꣬�����˸
	lcd1602_write_cmd(0x06);//д�������ݺ������ƣ���ʾ�����ƶ�
	lcd1602_write_cmd(0x01);//����	
}
#endif

/*******************************************************************************
* �� �� ��       : lcd1602_clear
* ��������		 : LCD1602����
* ��    ��       : ��
* ��    ��    	 : ��
*******************************************************************************/
void lcd1602_clear(void)
{
	lcd1602_write_cmd(0x01);	
}

/*******************************************************************************
* �� �� ��       : lcd1602_show_string
* ��������		 : LCD1602��ʾ�ַ�
* ��    ��       : x,y����ʾ���꣬x=0~15��y=0~1;
				   str����ʾ�ַ���
* ��    ��    	 : ��
*******************************************************************************/
void lcd1602_show_string(u8 x,u8 y,u8 *str)
{
	u8 i=0;

	if(y>1|x>15)return;//���в���������ǿ���˳�

	if(y<1)	//��1����ʾ
	{	
		while(*str!='\0')//�ַ�������'\0'��β��ֻҪǰ�������ݾ���ʾ
		{
			if(i<16-x)//����ַ����ȳ�����һ����ʾ��Χ�����ڵڶ��м�����ʾ
			{
				lcd1602_write_cmd(0x80+i+x);//��һ����ʾ��ַ����	
			}
			else
			{
				lcd1602_write_cmd(0x40+0x80+i+x-16);//�ڶ�����ʾ��ַ����	
			}
			lcd1602_write_data(*str);//��ʾ����
			str++;//ָ�����
			i++;	
		}	
	}
	else	//��2����ʾ
	{
		while(*str!='\0')
		{
			if(i<16-x) //����ַ����ȳ����ڶ�����ʾ��Χ�����ڵ�һ�м�����ʾ
			{
				lcd1602_write_cmd(0x80+0x40+i+x);	
			}
			else
			{
				lcd1602_write_cmd(0x80+i+x-16);	
			}
			lcd1602_write_data(*str);
			str++;
			i++;	
		}	
	}				
}

/*******************************************************************************
* �� �� ��       : lcd1602_num_2_str
* ��������		 : ������ת��Ϊ�ַ�������ʾ��LCD1602��
* ��    ��       : ����
* ��    ��    	 : Ҫ��ʾ���ַ���
*******************************************************************************/
unsigned char * lcd1602_num_2_str(unsigned char num){
	static unsigned char key_str[3];  // ���ڴ洢�����ַ����ַ���,ע�������'\0'
	if(num>=10){
		key_str[0]=1+'0';
		key_str[1]=num-10+'0';
	}else{
		key_str[0]=0+'0';
		key_str[1]=num+'0';
	}
		key_str[2]='\0';//�ַ��������
	return key_str;
}
