#include "lcd1602.h"

/*******************************************************************************
* ?? ?? ??       : delay_10us
* ????????		 : ?????????ten_us=1?????????10us
* ??    ??       : ten_us
* ??    ??    	 : ??
*******************************************************************************/
void delay_10us(u16 ten_us)
{
	while(ten_us--);	
}

/*******************************************************************************
* ?? ?? ??       : delay_ms
* ????????		 : ms?????????ms=1?????????1ms
* ??    ??       : ms??ms??????
* ??    ??    	 : ??
*******************************************************************************/
void delay_ms(u16 ms)
{
	u16 i,j;
	for(i=ms;i>0;i--)
		for(j=110;j>0;j--);
}
/*******************************************************************************
* ?? ?? ??       : lcd1602_write_cmd
* ????????		 : LCD1602§Õ????
* ??    ??       : cmd?????
* ??    ??    	 : ??
*******************************************************************************/
#if (LCD1602_4OR8_DATA_INTERFACE==0)//8¦ËLCD
void lcd1602_write_cmd(u8 cmd)
{
	LCD1602_RS=0;//???????
	LCD1602_RW=0;//???§Õ
	LCD1602_E=0;
	LCD1602_DATAPORT=cmd;//???????
	delay_ms(1);
	LCD1602_E=1;//????E????????§Õ??
	delay_ms(1);
	LCD1602_E=0;//????E?????????§Õ??	
}
#else	//4¦ËLCD
void lcd1602_write_cmd(u8 cmd)
{
	LCD1602_RS=0;//???????
	LCD1602_RW=0;//???§Õ
	LCD1602_E=0;
	LCD1602_DATAPORT=cmd;//???????
	delay_ms(1);
	LCD1602_E=1;//????E????????§Õ??
	delay_ms(1);
	LCD1602_E=0;//????E?????????§Õ??
	
	LCD1602_DATAPORT=cmd<<4;//???????
	delay_ms(1);
	LCD1602_E=1;//????E????????§Õ??
	delay_ms(1);
	LCD1602_E=0;//????E?????????§Õ??	
}
#endif

/*******************************************************************************
* ?? ?? ??       : lcd1602_write_data
* ????????		 : LCD1602§Õ????
* ??    ??       : dat??????
* ??    ??    	 : ??
*******************************************************************************/
#if (LCD1602_4OR8_DATA_INTERFACE==0)//8¦ËLCD
void lcd1602_write_data(u8 dat) 
{
	LCD1602_RS=1;//???????
	LCD1602_RW=0;//???§Õ
	LCD1602_E=0;
	LCD1602_DATAPORT=dat;//???????
	delay_ms(1);
	LCD1602_E=1;//????E????????§Õ??
	delay_ms(1);
	LCD1602_E=0;//????E?????????§Õ??		
}
#else
void lcd1602_write_data(u8 dat) 
{
	LCD1602_RS=1;//???????
	LCD1602_RW=0;//???§Õ
	LCD1602_E=0;
	LCD1602_DATAPORT=dat;//???????
	delay_ms(1);
	LCD1602_E=1;//????E????????§Õ??
	delay_ms(1);
	LCD1602_E=0;//????E?????????§Õ??
	
	LCD1602_DATAPORT=dat<<4;//???????
	delay_ms(1);
	LCD1602_E=1;//????E????????§Õ??
	delay_ms(1);
	LCD1602_E=0;//????E?????????§Õ??		
}
#endif

/*******************************************************************************
* ?? ?? ??       : lcd1602_init
* ????????		 : LCD1602?????
* ??    ??       : ??
* ??    ??    	 : ??
*******************************************************************************/
#if (LCD1602_4OR8_DATA_INTERFACE==0)//8¦ËLCD
void lcd1602_init(void)
{
	lcd1602_write_cmd(0x38);//????????8¦Ë?????2?§µ?5*7????/???
	lcd1602_write_cmd(0x0c);//????????????????????
	lcd1602_write_cmd(0x06);//§Õ??????????????????????????
	lcd1602_write_cmd(0x01);//????	
}
#else
void lcd1602_init(void)
{
	lcd1602_write_cmd(0x28);//????????4¦Ë?????2?§µ?5*7????/???
	lcd1602_write_cmd(0x0c);//????????????????????
	lcd1602_write_cmd(0x06);//§Õ??????????????????????????
	lcd1602_write_cmd(0x01);//????	
}
#endif

/*******************************************************************************
* ?? ?? ??       : lcd1602_clear
* ????????		 : LCD1602????
* ??    ??       : ??
* ??    ??    	 : ??
*******************************************************************************/
void lcd1602_clear(void)
{
	lcd1602_write_cmd(0x01);	
}

/*******************************************************************************
* ?? ?? ??       : lcd1602_show_string
* ????????		 : LCD1602??????
* ??    ??       : x,y?????????x=0~15??y=0~1;
				   str??????????
* ??    ??    	 : ??
*******************************************************************************/
void lcd1602_show_string(u8 x,u8 y,u8 *str)
{
	u8 i=0;

	if(y>1 | x>15)return;//???§Ó???????????????

	if(y<1)	//??1?????
	{	
		while(*str!='\0')//?????????'\0'??¦Â?????????????????
		{
			if(i<16-x)//???????????????????????¦¶?????????§Þ??????
			{
				lcd1602_write_cmd(0x80+i+x);//???????????????	
			}
			else
			{
				lcd1602_write_cmd(0x40+0x80+i+x-16);//???????????????	
			}
			lcd1602_write_data(*str);//???????
			str++;//??????
			i++;	
		}	
	}
	else	//??2?????
	{
		while(*str!='\0')
		{
			if(i<16-x) //???????????????????????¦¶?????????§Þ??????
			{
				lcd1602_write_cmd(0x80+0x40+i+x);	
			}
			else
			{
				lcd1602_write_cmd(0x80+i+x-16);	
			}
			lcd1602_write_data(*str);
			str++;
			i++;	
		}	
	}				
}
